resource "aws_lb" "rapid7" {
  name               = "rapid7"
  internal           = false
  load_balancer_type = "network"

  subnets = [
    data.aws_subnet.public_subnets_a.id,
    data.aws_subnet.public_subnets_b.id,
    data.aws_subnet.public_subnets_c.id,
  ]

  enable_deletion_protection = true
}

resource "aws_lb_target_group" "rapid7" {
  name     = "rapid7"
  port     = 80
  protocol = "HTTP"
  vpc_id   = data.aws_vpc.shared.id
}

resource "aws_lb_target_group_attachment" "rapid7" {
  target_group_arn = aws_lb_target_group.rapid7.arn
  target_id        = aws_instance.rapid7_insightvm.id
  port             = 80
}
